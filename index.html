<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Generator Caption Spintax</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        .custom-scrollbar::-webkit-scrollbar { width: 8px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: #f1f1f1; border-radius: 4px; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #d1d5db; border-radius: 4px; }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover { background: #9ca3af; }
        body { overscroll-behavior: none; }
    </style>
</head>
<body class="bg-gray-50 h-screen overflow-hidden text-gray-800 font-sans">
    <div id="root" class="h-full"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // --- ICONS ---
        const IconShoppingBag = () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M6 2 3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4Z"/><path d="M3 6h18"/><path d="M16 10a4 4 0 0 1-8 0"/></svg>;
        const IconRefreshCw = () => <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"/><path d="M21 3v5h-5"/><path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"/><path d="M3 21v-5h5"/></svg>;
        const IconCopy = () => <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"/><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"/></svg>;
        const IconCheck = () => <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="20 6 9 17 4 12"/></svg>;
        const IconInfinity = () => <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M12 12c-2-2.67-4-4-6-4a4 4 0 1 0 0 8c2 0 4-1.33 6-4Zm0 0c2 2.67 4 4 6 4a4 4 0 1 0 0-8c-2 0-4 1.33-6 4Z"/></svg>;
        const IconWand = () => <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m21.64 3.64-1.28-1.28a1.21 1.21 0 0 0-1.72 0L2.36 18.64a1.21 1.21 0 0 0 0 1.72l1.28 1.28a1.2 1.2 0 0 0 1.72 0L21.64 5.36a1.2 1.2 0 0 0 0-1.72Z"/><path d="m14 7 3 3"/><path d="M5 6v4"/><path d="M19 14v4"/><path d="M10 2v2"/><path d="M7 8H3"/><path d="M21 16h-4"/><path d="M11 3H9"/></svg>;

        // --- SPINTAX LOGIC ---
        const processSpintax = (text) => {
            if (!text) return "";
            let result = text;
            // Regex untuk mencari {a|b|c}. Loop while untuk menangani nested spintax {a|{b|c}}
            while (result.match(/\{([^{}]+)\}/)) {
                result = result.replace(/\{([^{}]+)\}/g, (match, content) => {
                    const choices = content.split('|');
                    return choices[Math.floor(Math.random() * choices.length)];
                });
            }
            return result;
        };

        // --- APP COMPONENT ---
        function CaptionGenerator() {
            const [captionInput, setCaptionInput] = useState('');
            // Items sekarang menyimpan object { id, text } karena text-nya unik per item (akibat Spintax)
            const [items, setItems] = useState([]); 
            const [copiedIndex, setCopiedIndex] = useState(null);
            const [usedIndices, setUsedIndices] = useState([]);

            // Fungsi membuat batch baru dengan Spintax diproses saat generate
            const generateBatch = (count, inputText) => {
                const newItems = [];
                for (let i = 0; i < count; i++) {
                    const min = 10000;
                    const max = 99999;
                    const randomNum = Math.floor(min + Math.random() * (max - min + 1));
                    
                    // PROSES SPINTAX DISINI
                    const processedText = processSpintax(inputText);
                    
                    newItems.push({
                        id: randomNum.toString(),
                        text: processedText
                    });
                }
                return newItems;
            };

            // Reset: Generate ulang dari awal
            const resetItems = () => {
                const initialItems = generateBatch(4, captionInput); 
                setItems(initialItems);
                setUsedIndices([]);
            };

            // Load More: Tambah item saat scroll
            const loadMoreItems = () => {
                const moreItems = generateBatch(5, captionInput);
                setItems(prev => [...prev, ...moreItems]);
            };

            // Event Listener Scroll
            const handleScroll = (e) => {
                const { scrollTop, scrollHeight, clientHeight } = e.target;
                if (scrollTop + clientHeight >= scrollHeight - 50) {
                    loadMoreItems();
                }
            };

            // Efek awal load (kosongkan atau isi default jika perlu, disini kita biarkan kosong agar user paste)
            useEffect(() => {
                // Tidak auto-generate saat pertama load agar user fokus input dulu
                // Atau bisa generate kosong
            }, []);

            // Handle Perubahan Input (PENTING UNTUK UX SPINTAX)
            // Kita tidak update list secara live (karena spintax akan berganti2 terus setiap ketik)
            // User harus klik tombol "Generate"
            
            const handleCopy = (text, index) => {
                try {
                    const textArea = document.createElement("textarea");
                    textArea.value = text;
                    textArea.style.position = "fixed";
                    textArea.style.left = "-9999px";
                    textArea.style.top = "0";
                    document.body.appendChild(textArea);
                    textArea.focus();
                    textArea.select();
                    document.execCommand('copy');
                    document.body.removeChild(textArea);
                    
                    setCopiedIndex(index);
                    setTimeout(() => setCopiedIndex(null), 2000);
                    if (!usedIndices.includes(index)) {
                        setUsedIndices(prev => [...prev, index]);
                    }
                } catch (err) { console.error(err); }
            };

            return (
                <div className="h-screen bg-gray-50 py-4 px-4 font-sans text-gray-800 flex flex-col overflow-hidden">
                    <div className="max-w-7xl mx-auto w-full bg-white rounded-xl shadow-lg border border-gray-100 flex flex-col h-full overflow-hidden">
                        
                        {/* Header */}
                        <div className="bg-blue-600 p-4 text-white text-center shrink-0">
                            <h1 className="text-xl font-bold flex items-center justify-center gap-2">
                                <IconShoppingBag />
                                Generator Caption + Spintax
                            </h1>
                            <p className="text-blue-100 mt-1 text-xs">Support {`{Kata1|Kata2}`} untuk variasi teks otomatis</p>
                        </div>

                        {/* Layout Utama */}
                        <div className="flex-grow grid grid-cols-1 md:grid-cols-12 overflow-hidden h-full">
                            
                            {/* Kolom Kiri: Input Form */}
                            <div className="md:col-span-5 flex flex-col border-b md:border-b-0 md:border-r border-gray-200 bg-white relative z-10 h-full overflow-hidden">
                                <div className="p-4 flex-grow flex flex-col h-full overflow-hidden">
                                    <div className="mb-2 shrink-0 flex justify-between items-end">
                                        <label className="font-bold text-gray-700 text-lg flex items-center gap-2">
                                            Input Caption
                                        </label>
                                        <span className="text-[10px] bg-yellow-100 text-yellow-800 px-2 py-1 rounded border border-yellow-200">
                                            Gunakan format: {`{Halo|Hai}`}
                                        </span>
                                    </div>
                                    
                                    <textarea 
                                        className="flex-grow w-full p-4 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none transition font-sans text-sm resize-none shadow-inner bg-gray-50 focus:bg-white"
                                        placeholder={`Contoh Spintax:\n\n{Jual|Ready} Laptop {Murah|Bagus}\nKondisi {Mulus|Like New}\nMinat? {PM|WA}`}
                                        value={captionInput}
                                        onChange={(e) => setCaptionInput(e.target.value)}
                                    />

                                    {/* Tombol Generate Manual (Penting untuk Spintax agar tidak berubah tiap ketik) */}
                                    <button 
                                        onClick={resetItems}
                                        className="mt-3 w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-4 rounded-lg flex items-center justify-center gap-2 transition shadow-md active:scale-95"
                                    >
                                        <IconWand /> Generate / Update Hasil
                                    </button>
                                </div>
                            </div>

                            {/* Kolom Kanan: Hasil Infinity Scroll */}
                            <div className="md:col-span-7 flex flex-col bg-gray-50/50 p-4 h-full overflow-hidden">
                                <div className="flex justify-between items-center mb-4 shrink-0">
                                    <span className="font-semibold text-gray-700 flex items-center gap-2 text-sm md:text-base">
                                        <span className="bg-green-600 text-white text-xs px-2 py-0.5 rounded-full shadow-sm flex items-center gap-1">
                                            <IconInfinity /> Hasil Variasi
                                        </span>
                                        <span className="text-xs text-gray-400 font-normal hidden sm:inline">(Total: {items.length} item)</span>
                                    </span>
                                    
                                    <button 
                                        onClick={resetItems}
                                        className="text-xs md:text-sm flex items-center gap-1 bg-white hover:bg-blue-50 text-blue-600 px-3 py-1.5 md:px-4 md:py-2 rounded-full border border-blue-200 transition shadow-sm font-medium"
                                    >
                                        <IconRefreshCw /> <span className="hidden sm:inline">Acak Ulang</span>
                                    </button>
                                </div>
                                
                                {/* List Hasil */}
                                <div 
                                    className="flex-1 overflow-y-auto min-h-0 pr-2 pb-4 space-y-4 custom-scrollbar"
                                    onScroll={handleScroll}
                                >
                                    {items.length === 0 ? (
                                        <div className="flex flex-col items-center justify-center h-40 text-gray-400 text-sm">
                                            <p>Belum ada hasil.</p>
                                            <p>Masukkan caption & klik tombol <b>Generate</b></p>
                                        </div>
                                    ) : (
                                        items.map((item, index) => {
                                            const fullText = `${item.text}\n\n_ID: ${item.id}_`;
                                            const isCopied = copiedIndex === index;
                                            const isUsed = usedIndices.includes(index);

                                            return (
                                                <div key={index} 
                                                    className={`w-full relative flex flex-col border rounded-xl shadow-sm transition-all duration-200 
                                                    ${isCopied ? 'border-green-500 ring-2 ring-green-100 bg-white' : 
                                                      isUsed ? 'border-gray-300 bg-gray-100 opacity-80' : 
                                                      'bg-white border-gray-200 hover:border-blue-400 hover:shadow-md'}`}>
                                                    
                                                    {/* Header Item */}
                                                    <div className={`flex justify-between items-center p-3 border-b border-gray-100 rounded-t-xl shrink-0 
                                                        ${isUsed ? 'bg-gray-200' : 'bg-gradient-to-r from-gray-50 to-white'}`}>
                                                        <div className="flex items-center gap-2">
                                                            <span className="text-xs font-bold text-gray-500 uppercase tracking-wide">Variasi #{index + 1}</span>
                                                            {isUsed && (
                                                                <span className="text-[10px] bg-gray-600 text-white px-1.5 py-0.5 rounded font-medium">Sudah Dipakai</span>
                                                            )}
                                                        </div>
                                                        <span className={`text-xs font-mono font-bold px-2 py-0.5 border rounded ${isUsed ? 'text-gray-500 bg-gray-100 border-gray-300' : 'text-blue-600 bg-blue-50 border-blue-100'}`}>ID: {item.id}</span>
                                                    </div>

                                                    {/* Konten Teks */}
                                                    <div className="p-3">
                                                        <p className={`font-mono text-xs whitespace-pre-wrap line-clamp-6 ${isUsed ? 'text-gray-500' : 'text-gray-600'}`}>
                                                            {fullText}
                                                        </p>
                                                    </div>

                                                    {/* Tombol Copy */}
                                                    <div className={`p-3 border-t border-gray-100 rounded-b-xl shrink-0 ${isUsed ? 'bg-gray-200' : 'bg-gray-50'}`}>
                                                        <button 
                                                            onClick={() => handleCopy(fullText, index)}
                                                            className={`w-full py-2 px-3 rounded-lg text-sm font-bold flex items-center justify-center gap-2 transition-all duration-200 ${
                                                                isCopied 
                                                                ? 'bg-green-500 text-white shadow-md transform scale-[1.01]' 
                                                                : isUsed
                                                                    ? 'bg-gray-400 text-white hover:bg-gray-500' 
                                                                    : 'bg-gray-800 hover:bg-gray-900 text-white shadow-sm hover:shadow'
                                                            }`}
                                                        >
                                                            {isCopied ? (
                                                                <span className="flex items-center justify-center gap-2"><IconCheck /> Tersalin!</span>
                                                            ) : (
                                                                <span className="flex items-center justify-center gap-2"><IconCopy /> {isUsed ? 'Copy Lagi' : 'Copy Text'}</span>
                                                            )}
                                                        </button>
                                                    </div>
                                                </div>
                                            );
                                        })
                                    )}
                                    
                                    {items.length > 0 && (
                                        <div className="text-center py-4 text-gray-400 text-xs italic">
                                            Scroll terus untuk variasi lainnya...
                                        </div>
                                    )}
                                </div>
                            </div>

                        </div>
                    </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<CaptionGenerator />);
    </script>
</body>
</html>
