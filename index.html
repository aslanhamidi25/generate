<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Generator Caption Spintax</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        .custom-scrollbar::-webkit-scrollbar { width: 8px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: #f1f1f1; border-radius: 4px; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #d1d5db; border-radius: 4px; }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover { background: #9ca3af; }
        body { overscroll-behavior: none; }
    </style>
</head>
<body class="bg-gray-50 h-screen overflow-hidden text-gray-800 font-sans">
    <div id="root" class="h-full"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // --- ICONS ---
        const IconShoppingBag = () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M6 2 3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4Z"/><path d="M3 6h18"/><path d="M16 10a4 4 0 0 1-8 0"/></svg>;
        const IconRefreshCw = () => <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"/><path d="M21 3v5h-5"/><path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"/><path d="M3 21v-5h5"/></svg>;
        const IconCopy = () => <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"/><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"/></svg>;
        const IconCheck = () => <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="20 6 9 17 4 12"/></svg>;
        const IconInfinity = () => <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M12 12c-2-2.67-4-4-6-4a4 4 0 1 0 0 8c2 0 4-1.33 6-4Zm0 0c2 2.67 4 4 6 4a4 4 0 1 0 0-8c-2 0-4 1.33-6 4Z"/></svg>;
        const IconWand = () => <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m21.64 3.64-1.28-1.28a1.21 1.21 0 0 0-1.72 0L2.36 18.64a1.21 1.21 0 0 0 0 1.72l1.28 1.28a1.2 1.2 0 0 0 1.72 0L21.64 5.36a1.2 1.2 0 0 0 0-1.72Z"/><path d="m14 7 3 3"/><path d="M5 6v4"/><path d="M19 14v4"/><path d="M10 2v2"/><path d="M7 8H3"/><path d="M21 16h-4"/><path d="M11 3H9"/></svg>;
        const IconEdit = () => <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z"/></svg>;
        const IconZap = () => <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/></svg>;

        // --- SPINTAX LOGIC ---
        const processSpintax = (text) => {
            if (!text) return "";
            let result = text;
            while (result.match(/\{([^{}]+)\}/)) {
                result = result.replace(/\{([^{}]+)\}/g, (match, content) => {
                    const choices = content.split('|');
                    return choices[Math.floor(Math.random() * choices.length)];
                });
            }
            return result;
        };

        // --- SPINTAX TEMPLATES (AUTOMATIC MODE) ---
        const AUTO_TEMPLATES = {
            opening: "{izin posting min|izin share min|izin lapak min|izin promosi min|permisi posting min|numpang posting min|ijin posting admin|min, izin posting}",
            conditions: "{baru|new|kondisi baru|fresh unit|belum pernah dipakai|masih baru} {fullset|lengkap|kelengkapan lengkap|full kelengkapan|set lengkap|paket lengkap}, {segel|masih segel|segel pabrik|segel utuh|belum dibuka|segel resmi}, {garansi|bergaransi|jaminan|ada garansi|garansi resmi} {resmi|official|original|ori|legal}",
            priceLabel: "{harga murah|harga terjangkau|harga bersahabat|best price|harga promo|harga spesial hari ini|harga deal terbaik}",
            linkLabel: "{link pembelian|link beli|link checkout|link order|tautan pembelian|tautan beli|link pemesanan|link transaksi}"
        };

        // --- APP COMPONENT ---
        function CaptionGenerator() {
            // Tab State: 'manual' or 'auto'
            const [activeTab, setActiveTab] = useState('manual');
            
            // Manual Input State
            const [captionInput, setCaptionInput] = useState('');
            
            // Auto Input State
            const [autoForm, setAutoForm] = useState({
                productName: '',
                price: '',
                link: ''
            });

            // Results State
            const [items, setItems] = useState([]); 
            const [copiedIndex, setCopiedIndex] = useState(null);
            const [usedIndices, setUsedIndices] = useState([]);

            // Effect: Construct Caption when in Auto Mode
            useEffect(() => {
                if (activeTab === 'auto') {
                    const constructedCaption = 
`${AUTO_TEMPLATES.opening}

${autoForm.productName || "[Nama Barang]"}

${AUTO_TEMPLATES.conditions}

${AUTO_TEMPLATES.priceLabel} : Rp.${autoForm.price || "..."}

${AUTO_TEMPLATES.linkLabel} : 
${autoForm.link || "..."}`;

                    setCaptionInput(constructedCaption);
                }
            }, [activeTab, autoForm]);

            // Fungsi Generate Batch
            const generateBatch = (count, inputText) => {
                const newItems = [];
                for (let i = 0; i < count; i++) {
                    const min = 10000;
                    const max = 99999;
                    const randomNum = Math.floor(min + Math.random() * (max - min + 1));
                    const processedText = processSpintax(inputText);
                    
                    newItems.push({
                        id: randomNum.toString(),
                        text: processedText
                    });
                }
                return newItems;
            };

            const resetItems = () => {
                const initialItems = generateBatch(4, captionInput); 
                setItems(initialItems);
                setUsedIndices([]);
            };

            const loadMoreItems = () => {
                const moreItems = generateBatch(5, captionInput);
                setItems(prev => [...prev, ...moreItems]);
            };

            const handleScroll = (e) => {
                const { scrollTop, scrollHeight, clientHeight } = e.target;
                if (scrollTop + clientHeight >= scrollHeight - 50) {
                    loadMoreItems();
                }
            };

            const handleCopy = (text, index) => {
                try {
                    const textArea = document.createElement("textarea");
                    textArea.value = text;
                    textArea.style.position = "fixed";
                    textArea.style.left = "-9999px";
                    textArea.style.top = "0";
                    document.body.appendChild(textArea);
                    textArea.focus();
                    textArea.select();
                    document.execCommand('copy');
                    document.body.removeChild(textArea);
                    
                    setCopiedIndex(index);
                    setTimeout(() => setCopiedIndex(null), 2000);
                    if (!usedIndices.includes(index)) {
                        setUsedIndices(prev => [...prev, index]);
                    }
                } catch (err) { console.error(err); }
            };

            // Input handlers for Auto Form
            const handleAutoChange = (field, value) => {
                setAutoForm(prev => ({
                    ...prev,
                    [field]: value
                }));
            };

            return (
                <div className="h-screen bg-gray-50 py-4 px-4 font-sans text-gray-800 flex flex-col overflow-hidden">
                    <div className="max-w-7xl mx-auto w-full bg-white rounded-xl shadow-lg border border-gray-100 flex flex-col h-full overflow-hidden">
                        
                        {/* Header */}
                        <div className="bg-blue-600 p-4 text-white text-center shrink-0">
                            <h1 className="text-xl font-bold flex items-center justify-center gap-2">
                                <IconShoppingBag />
                                Generator Caption + Spintax
                            </h1>
                            <p className="text-blue-100 mt-1 text-xs">Pilih mode input dan dapatkan variasi caption otomatis</p>
                        </div>

                        {/* Layout Utama */}
                        <div className="flex-grow grid grid-cols-1 md:grid-cols-12 overflow-hidden h-full">
                            
                            {/* Kolom Kiri: Input Form */}
                            <div className="md:col-span-5 flex flex-col border-b md:border-b-0 md:border-r border-gray-200 bg-white relative z-10 h-full overflow-hidden">
                                <div className="p-4 flex-grow flex flex-col h-full overflow-hidden">
                                    
                                    {/* Tab Switcher */}
                                    <div className="flex bg-gray-100 p-1 rounded-lg mb-4 shrink-0">
                                        <button 
                                            onClick={() => setActiveTab('manual')}
                                            className={`flex-1 flex items-center justify-center gap-2 py-2 text-sm font-bold rounded-md transition-all ${activeTab === 'manual' ? 'bg-white text-blue-600 shadow-sm' : 'text-gray-500 hover:text-gray-700'}`}
                                        >
                                            <IconEdit /> Manual Spintax
                                        </button>
                                        <button 
                                            onClick={() => setActiveTab('auto')}
                                            className={`flex-1 flex items-center justify-center gap-2 py-2 text-sm font-bold rounded-md transition-all ${activeTab === 'auto' ? 'bg-white text-blue-600 shadow-sm' : 'text-gray-500 hover:text-gray-700'}`}
                                        >
                                            <IconZap /> Spintax Otomatis
                                        </button>
                                    </div>

                                    {/* CONTENT: MANUAL MODE */}
                                    {activeTab === 'manual' && (
                                        <div className="flex flex-col h-full overflow-hidden animate-fade-in">
                                            <div className="mb-2 shrink-0 flex justify-between items-end">
                                                <label className="font-bold text-gray-700 text-sm">
                                                    Input Raw Caption
                                                </label>
                                                <span className="text-[10px] bg-yellow-100 text-yellow-800 px-2 py-1 rounded border border-yellow-200">
                                                    Format: {`{Halo|Hai}`}
                                                </span>
                                            </div>
                                            <textarea 
                                                className="flex-grow w-full p-4 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none transition font-sans text-sm resize-none shadow-inner bg-gray-50 focus:bg-white"
                                                placeholder={`Contoh Spintax:\n\n{Jual|Ready} Laptop {Murah|Bagus}\nKondisi {Mulus|Like New}\nMinat? {PM|WA}`}
                                                value={captionInput}
                                                onChange={(e) => setCaptionInput(e.target.value)}
                                            />
                                        </div>
                                    )}

                                    {/* CONTENT: AUTO MODE */}
                                    {activeTab === 'auto' && (
                                        <div className="flex flex-col h-full overflow-y-auto pr-1 animate-fade-in custom-scrollbar">
                                            <div className="mb-4 bg-blue-50 p-3 rounded-lg border border-blue-100 text-xs text-blue-800">
                                                <b>Info:</b> Kolom di bawah ini akan otomatis dibungkus dengan kalimat promosi (Spintax) yang sudah disetting.
                                            </div>

                                            <div className="space-y-4">
                                                <div>
                                                    <label className="block text-sm font-bold text-gray-700 mb-1">Nama Barang</label>
                                                    <input 
                                                        type="text" 
                                                        className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none"
                                                        placeholder="Contoh: Sony A6000 Kit"
                                                        value={autoForm.productName}
                                                        onChange={(e) => handleAutoChange('productName', e.target.value)}
                                                    />
                                                </div>

                                                <div>
                                                    <label className="block text-sm font-bold text-gray-700 mb-1">Harga (Rp)</label>
                                                    <div className="relative">
                                                        <span className="absolute left-3 top-3 text-gray-500 text-sm">Rp.</span>
                                                        <input 
                                                            type="text" 
                                                            className="w-full pl-10 p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none"
                                                            placeholder="1.xxx.xxx"
                                                            value={autoForm.price}
                                                            onChange={(e) => handleAutoChange('price', e.target.value)}
                                                        />
                                                    </div>
                                                </div>

                                                <div>
                                                    <label className="block text-sm font-bold text-gray-700 mb-1">Link Pembelian / Kontak</label>
                                                    <textarea 
                                                        rows="3"
                                                        className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none resize-none"
                                                        placeholder="https://shopee.co.id/..."
                                                        value={autoForm.link}
                                                        onChange={(e) => handleAutoChange('link', e.target.value)}
                                                    />
                                                </div>

                                                <div className="pt-2">
                                                    <label className="block text-xs font-semibold text-gray-500 mb-1">Preview Spintax (Otomatis):</label>
                                                    <div className="p-2 bg-gray-100 rounded text-[10px] text-gray-600 font-mono h-24 overflow-y-auto border border-gray-200">
                                                        {captionInput || "Isi form di atas untuk melihat preview..."}
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    )}

                                    {/* Tombol Generate Manual */}
                                    <button 
                                        onClick={resetItems}
                                        className="mt-4 shrink-0 w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-4 rounded-lg flex items-center justify-center gap-2 transition shadow-md active:scale-95"
                                    >
                                        <IconWand /> Generate / Update Hasil
                                    </button>
                                </div>
                            </div>

                            {/* Kolom Kanan: Hasil Infinity Scroll */}
                            <div className="md:col-span-7 flex flex-col bg-gray-50/50 p-4 h-full overflow-hidden">
                                <div className="flex justify-between items-center mb-4 shrink-0">
                                    <span className="font-semibold text-gray-700 flex items-center gap-2 text-sm md:text-base">
                                        <span className="bg-green-600 text-white text-xs px-2 py-0.5 rounded-full shadow-sm flex items-center gap-1">
                                            <IconInfinity /> Hasil Variasi
                                        </span>
                                        <span className="text-xs text-gray-400 font-normal hidden sm:inline">(Total: {items.length} item)</span>
                                    </span>
                                    
                                    <button 
                                        onClick={resetItems}
                                        className="text-xs md:text-sm flex items-center gap-1 bg-white hover:bg-blue-50 text-blue-600 px-3 py-1.5 md:px-4 md:py-2 rounded-full border border-blue-200 transition shadow-sm font-medium"
                                    >
                                        <IconRefreshCw /> <span className="hidden sm:inline">Acak Ulang</span>
                                    </button>
                                </div>
                                
                                {/* List Hasil */}
                                <div 
                                    className="flex-1 overflow-y-auto min-h-0 pr-2 pb-4 space-y-4 custom-scrollbar"
                                    onScroll={handleScroll}
                                >
                                    {items.length === 0 ? (
                                        <div className="flex flex-col items-center justify-center h-40 text-gray-400 text-sm">
                                            <p>Belum ada hasil.</p>
                                            <p>Masukkan caption & klik tombol <b>Generate</b></p>
                                        </div>
                                    ) : (
                                        items.map((item, index) => {
                                            const fullText = `${item.text}\n\n_ID: ${item.id}_`;
                                            const isCopied = copiedIndex === index;
                                            const isUsed = usedIndices.includes(index);

                                            return (
                                                <div key={index} 
                                                    className={`w-full relative flex flex-col border rounded-xl shadow-sm transition-all duration-200 
                                                    ${isCopied ? 'border-green-500 ring-2 ring-green-100 bg-white' : 
                                                      isUsed ? 'border-gray-300 bg-gray-100 opacity-80' : 
                                                      'bg-white border-gray-200 hover:border-blue-400 hover:shadow-md'}`}>
                                                    
                                                    {/* Header Item */}
                                                    <div className={`flex justify-between items-center p-3 border-b border-gray-100 rounded-t-xl shrink-0 
                                                        ${isUsed ? 'bg-gray-200' : 'bg-gradient-to-r from-gray-50 to-white'}`}>
                                                        <div className="flex items-center gap-2">
                                                            <span className="text-xs font-bold text-gray-500 uppercase tracking-wide">Variasi #{index + 1}</span>
                                                            {isUsed && (
                                                                <span className="text-[10px] bg-gray-600 text-white px-1.5 py-0.5 rounded font-medium">Sudah Dipakai</span>
                                                            )}
                                                        </div>
                                                        <span className={`text-xs font-mono font-bold px-2 py-0.5 border rounded ${isUsed ? 'text-gray-500 bg-gray-100 border-gray-300' : 'text-blue-600 bg-blue-50 border-blue-100'}`}>ID: {item.id}</span>
                                                    </div>

                                                    {/* Konten Teks */}
                                                    <div className="p-3">
                                                        <p className={`font-mono text-xs whitespace-pre-wrap line-clamp-6 ${isUsed ? 'text-gray-500' : 'text-gray-600'}`}>
                                                            {fullText}
                                                        </p>
                                                    </div>

                                                    {/* Tombol Copy */}
                                                    <div className={`p-3 border-t border-gray-100 rounded-b-xl shrink-0 ${isUsed ? 'bg-gray-200' : 'bg-gray-50'}`}>
                                                        <button 
                                                            onClick={() => handleCopy(fullText, index)}
                                                            className={`w-full py-2 px-3 rounded-lg text-sm font-bold flex items-center justify-center gap-2 transition-all duration-200 ${
                                                                isCopied 
                                                                ? 'bg-green-500 text-white shadow-md transform scale-[1.01]' 
                                                                : isUsed
                                                                    ? 'bg-gray-400 text-white hover:bg-gray-500' 
                                                                    : 'bg-gray-800 hover:bg-gray-900 text-white shadow-sm hover:shadow'
                                                            }`}
                                                        >
                                                            {isCopied ? (
                                                                <span className="flex items-center justify-center gap-2"><IconCheck /> Tersalin!</span>
                                                            ) : (
                                                                <span className="flex items-center justify-center gap-2"><IconCopy /> {isUsed ? 'Copy Lagi' : 'Copy Text'}</span>
                                                            )}
                                                        </button>
                                                    </div>
                                                </div>
                                            );
                                        })
                                    )}
                                    
                                    {items.length > 0 && (
                                        <div className="text-center py-4 text-gray-400 text-xs italic">
                                            Scroll terus untuk variasi lainnya...
                                        </div>
                                    )}
                                </div>
                            </div>

                        </div>
                    </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<CaptionGenerator />);
    </script>
</body>
</html>
